<!DOCTYPE html>
<html lang="sl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>3D DEMO Naroƒçila</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(145deg, #0f0f0f, #1c1c1c);
    color: #eee;
  }
  .container {
    max-width: 700px;
    margin: 30px auto;
    background: rgba(30, 30, 30, 0.9);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  }
  h1, h2 {
    text-align: center;
  }
  form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  form input, form select {
    padding: 10px;
    border: none;
    border-radius: 5px;
    background: #222;
    color: #eee;
  }
  form button {
    grid-column: 1 / -1;
    background: #0d6efd;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
  }
  table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #444;
    padding: 8px;
  }
  th {
    background: #0d6efd;
  }
  #loginContainer, #appContainer {
    display: none;
  }
  .visible {
    display: block;
  }
</style>
</head>
<body>

<div class="container visible" id="loginContainer">
  <h1>Prijava</h1>
  <input type="email" id="emailLogin" placeholder="Email" required />
  <input type="password" id="gesloLogin" placeholder="Geslo" required />
  <button id="prijavaBtn">Prijava</button>
</div>

<div class="container" id="appContainer">
  <h1>Dobrodo≈°el! üéâ</h1>
  <h2>Dodaj naroƒçilo</h2>
  <form id="orderForm">
    <input type="text" placeholder="Ime" id="ime" required />
    <input type="text" placeholder="Priimek" id="priimek" required />
    <input type="email" placeholder="Email" id="email" required />
    <input type="tel" placeholder="Telefon" id="telefon" required />
    <input type="text" placeholder="≈†t. izd." id="stIzdelka" required />
    <input type="text" placeholder="Ime izdelka" id="imeIzdelka" required />
    <input type="number" placeholder="Koliƒçina" id="kolicina" required />
    <input type="number" placeholder="Zaloga" id="zaloga" required />
    <select id="statusNarocila">
      <option value="Novo">Novo</option>
      <option value="V obdelavi">V obdelavi</option>
      <option value="Zakljuƒçeno">Zakljuƒçeno</option>
    </select>
    <button type="button" id="oddajNarociloBtn">Shrani naroƒçilo</button>
  </form>

  <h2>Moja naroƒçila</h2>
  <table>
    <thead>
      <tr>
        <th>#</th><th>Ime</th><th>Priimek</th><th>Email</th><th>Telefon</th>
        <th>≈†t. izd.</th><th>Izdelek</th><th>Koliƒçina</th><th>Zaloga</th><th>Status</th>
      </tr>
    </thead>
    <tbody id="ordersTableBody"></tbody>
  </table>
</div>

<!-- Firebase SDK in aplikacija -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBhNAXc73xf3MDWvtzqPflPzo5ctGspQrc",
    authDomain: "d-narocila.firebaseapp.com",
    projectId: "d-narocila",
    storageBucket: "d-narocila.appspot.com",
    messagingSenderId: "520918393310",
    appId: "1:520918393310:web:a25bb3e86789b4f7f7fd4f",
    measurementId: "G-BD9Q07M17B"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  async function prijava(email, geslo) {
    try {
      await signInWithEmailAndPassword(auth, email, geslo);
      document.getElementById("loginContainer").classList.remove("visible");
      document.getElementById("appContainer").classList.add("visible");
      naloziNarocila();
    } catch (err) {
      alert("Napaka pri prijavi: " + err.message);
    }
  }

  async function dodajNarocilo(narocilo) {
    try {
      await addDoc(collection(db, "narocila"), narocilo);
      alert("Naroƒçilo shranjeno!");
      naloziNarocila();
      document.getElementById("orderForm").reset();
    } catch (err) {
      alert("Napaka pri vnosu: " + err.message);
    }
  }

  async function naloziNarocila() {
    const user = auth.currentUser;
    if (!user) return;
    const q = query(collection(db, "narocila"), where("uid", "==", user.uid));
    const querySnapshot = await getDocs(q);
    const tbody = document.getElementById("ordersTableBody");
    tbody.innerHTML = "";
    let i = 1;
    querySnapshot.forEach(doc => {
      const n = doc.data();
      const row = document.createElement("tr");
      row.innerHTML = `<td>${i++}</td><td>${n.ime}</td><td>${n.priimek}</td><td>${n.email}</td>
        <td>${n.telefon}</td><td>${n.stIzdelka}</td><td>${n.imeIzdelka}</td>
        <td>${n.kolicina}</td><td>${n.zaloga}</td><td>${n.status}</td>`;
      tbody.appendChild(row);
    });
  }

  document.getElementById("prijavaBtn").addEventListener("click", () => {
    const email = document.getElementById("emailLogin").value;
    const geslo = document.getElementById("gesloLogin").value;
    prijava(email, geslo);
  });

  document.getElementById("oddajNarociloBtn").addEventListener("click", () => {
    const user = auth.currentUser;
    if (!user) {
      alert("Najprej se prijavi!");
      return;
    }
    const narocilo = {
      uid: user.uid,
      ime: document.getElementById("ime").value,
      priimek: document.getElementById("priimek").value,
      email: document.getElementById("email").value,
      telefon: document.getElementById("telefon").value,
      stIzdelka: document.getElementById("stIzdelka").value,
      imeIzdelka: document.getElementById("imeIzdelka").value,
      kolicina: document.getElementById("kolicina").value,
      zaloga: document.getElementById("zaloga").value,
      status: document.getElementById("statusNarocila").value
    };
    dodajNarocilo(narocilo);
  });

  onAuthStateChanged(auth, user => {
    if (user) {
      document.getElementById("loginContainer").classList.remove("visible");
      document.getElementById("appContainer").classList.add("visible");
      naloziNarocila();
    }
  });
</script>
</body>
</html>
